import 'dart:ui';

import 'package:cached_network_image/cached_network_image.dart';
import 'package:fish_redux/fish_redux.dart';
import 'package:flutter/material.dart';
import 'package:flutter_rating_bar/flutter_rating_bar.dart';
import 'package:font_awesome_flutter/font_awesome_flutter.dart';
import 'package:intl/intl.dart';
import 'package:colorlive/actions/Adapt.dart';
import 'package:colorlive/actions/imageurl.dart';
import 'package:colorlive/customwidgets/scrollview_background.dart';
import 'package:colorlive/customwidgets/shimmercell.dart';
import 'package:colorlive/customwidgets/sliverappbar_delegate.dart';
import 'package:colorlive/generated/i18n.dart';
import 'package:colorlive/models/creditsmodel.dart';
import 'package:colorlive/models/enums/imagesize.dart';
import 'package:colorlive/models/imagemodel.dart';
import 'package:colorlive/models/keyword.dart';
import 'package:colorlive/models/videolist.dart';
import 'package:shimmer/shimmer.dart';

import 'action.dart';
import 'state.dart';

Widget buildView(
    MovieDetailPageState state, Dispatch dispatch, ViewService viewService) {
  String _covertDuration(int d) {
    String result = '';
    Duration duration = Duration(minutes: d);
    int h = duration.inHours;
    int countedMin = h * 60;
    int m = duration.inMinutes - countedMin;
    result += h > 0 ? '$h h ' : '';
    result += '$m min';
    return result;
  }

  return Builder(builder: (context) {
    final _lightTheme = ThemeData.light().copyWith(
        backgroundColor: Colors.white,
        cardColor: Colors.white,
        primaryColorLight: Colors.grey[100],
        primaryColorDark: Colors.grey[200]);
    final _darkTheme = ThemeData.dark().copyWith(
        backgroundColor: Color(0xFF303030),
        cardColor: Color(0xFF505050),
        primaryColorLight: Color(0xFF505050),
        primaryColorDark: Color(0xFF404040));
    final MediaQueryData _mediaQuery = MediaQuery.of(context);
    final ThemeData _theme = _mediaQuery.platformBrightness == Brightness.light
        ? _lightTheme
        : _darkTheme;
    Widget _buildRecommendationShimmerCell() {
      double _width = Adapt.px(220);
      return SizedBox(
        width: _width,
        child: Shimmer.fromColors(
          baseColor: _theme.primaryColorDark,
          highlightColor: _theme.primaryColorLight,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: <Widget>[
              Container(
                width: _width,
                height: Adapt.px(320),
                decoration: BoxDecoration(
                  color: Colors.grey[200],
                ),
              ),
              SizedBox(
                height: Adapt.px(15),
              ),
              Container(
                width: _width,
                height: Adapt.px(30),
                color: Colors.grey[200],
              ),
              SizedBox(
                height: Adapt.px(8),
              ),
              Container(
                width: _width - Adapt.px(50),
                height: Adapt.px(30),
                color: Colors.grey[200],
              ),
              SizedBox(
                height: Adapt.px(8),
              ),
            ],
          ),
        ),
      );
    }

    Widget _buildImage(String url, double width, double height, double radius,
        {EdgeInsetsGeometry margin = EdgeInsets.zero, ValueKey key}) {
      return Container(
        key: key,
        width: width,
        height: height,
        margin: margin,
        decoration: BoxDecoration(
            color: _theme.primaryColorDark,
            borderRadius: BorderRadius.circular(radius),
            image: DecorationImage(
                fit: BoxFit.cover, image: CachedNetworkImageProvider(url))),
      );
    }

    Widget _buildExternalCell(String icon, String url, String id) {
      return id != null
          ? InkWell(
              borderRadius: BorderRadius.circular(Adapt.px(20)),
              onTap: () => dispatch(
                  MovieDetailPageActionCreator.onExternalTapped(url + id)),
              child: Container(
                width: Adapt.px(40),
                height: Adapt.px(40),
                child: Image.asset(
                  icon,
                  color: _theme.iconTheme.color,
                ),
              ),
            )
          : Container();
    }

    Widget _getExternal() {
      var _detail = state.detail;
      var _ids = _detail.externalids;
      if (_ids != null)
        return Row(
          mainAxisAlignment: MainAxisAlignment.end,
          children: <Widget>[
            _buildExternalCell('images/facebook_circle.png',
                'https://www.facebook.com/', _ids.facebookId),
            SizedBox(
              width: Adapt.px(10),
            ),
            _buildExternalCell('images/twitter_circle.png',
                'https://twitter.com/', _ids.twitterId),
            SizedBox(
              width: Adapt.px(10),
            ),
            _buildExternalCell('images/instagram_circle.png',
                'https://www.instagram.com/', _ids.instagramId),
            SizedBox(
              width: Adapt.px(20),
            ),
            (_ids.facebookId == null &&
                        _ids.twitterId == null &&
                        _ids.instagramId == null) ||
                    _detail.homepage == null
                ? Container()
                : Container(
                    width: Adapt.px(2),
                    height: Adapt.px(30),
                    color: Colors.grey,
                  ),
            SizedBox(
              width: Adapt.px(20),
            ),
            _detail.homepage != null
                ? InkWell(
                    borderRadius: BorderRadius.circular(Adapt.px(15)),
                    onTap: () => dispatch(
                        MovieDetailPageActionCreator.onExternalTapped(
                            _detail.homepage)),
                    child: Container(
                      width: Adapt.px(30),
                      height: Adapt.px(30),
                      child: Image.asset('images/link_bold.png',
                          color: _theme.iconTheme.color),
                    ))
                : SizedBox(),
          ],
        );
      else
        return Row(
          children: <Widget>[
            ShimmerCell(Adapt.px(60), Adapt.px(60), Adapt.px(30),
                baseColor: _theme.primaryColorDark,
                highlightColor: _theme.primaryColorLight),
            SizedBox(
              width: Adapt.px(20),
            ),
            ShimmerCell(Adapt.px(60), Adapt.px(60), Adapt.px(30),
                baseColor: _theme.primaryColorDark,
                highlightColor: _theme.primaryColorLight),
            SizedBox(
              width: Adapt.px(20),
            ),
            ShimmerCell(Adapt.px(60), Adapt.px(60), Adapt.px(30),
                baseColor: _theme.primaryColorDark,
                highlightColor: _theme.primaryColorLight)
          ],
        );
    }

    Widget _buildCastCell(CastData d) {
      double width = Adapt.px(150);
      return GestureDetector(
        onTap: () => dispatch(MovieDetailPageActionCreator.castCellTapped(
            d.id, d.profile_path, d.name, d.character)),
        child: Column(
          key: ValueKey('Cast${d.id}'),
          children: <Widget>[
            Hero(
                tag: 'people${d.id}',
                child: Material(
                  color: Colors.transparent,
                  child: Container(
                    margin: EdgeInsets.only(right: Adapt.px(30)),
                    width: width,
                    height: width,
                    decoration: BoxDecoration(
                        borderRadius: BorderRadius.circular(Adapt.px(15)),
                        color: _theme.primaryColorDark,
                        image: DecorationImage(
                            fit: BoxFit.cover,
                            image: CachedNetworkImageProvider(ImageUrl.getUrl(
                                d.profile_path, ImageSize.w300)))),
                  ),
                )),
            SizedBox(
              height: Adapt.px(10),
            ),
            Container(
                width: width,
                child: Text(
                  d.name ?? '',
                  maxLines: 2,
                  style: TextStyle(fontWeight: FontWeight.bold),
                )),
            Container(
                width: width,
                child: Text(
                  d.character ?? '',
                  maxLines: 2,
                  style: TextStyle(color: Colors.grey, fontSize: Adapt.px(24)),
                ))
          ],
        ),
      );
    }

    Widget _buildCastShimmerCell() {
      double width = Adapt.px(150);
      return Shimmer.fromColors(
        baseColor: _theme.primaryColorDark,
        highlightColor: _theme.primaryColorLight,
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: <Widget>[
            Container(
              margin: EdgeInsets.only(right: Adapt.px(30)),
              width: width,
              height: width,
              decoration: BoxDecoration(
                borderRadius: BorderRadius.circular(Adapt.px(15)),
                color: Colors.grey[200],
              ),
            ),
            SizedBox(
              height: Adapt.px(10),
            ),
            Container(
              width: width,
              height: Adapt.px(24),
              color: Colors.grey[200],
            ),
            SizedBox(
              height: Adapt.px(10),
            ),
            Container(
              width: Adapt.px(100),
              height: Adapt.px(24),
              color: Colors.grey[200],
            )
          ],
        ),
      );
    }

    Widget _buildImageCell(ImageData d) {
      String url = ImageUrl.getUrl(d.file_path, ImageSize.w500);
      int index = state.imagesmodel.backdrops.indexOf(d);
      return GestureDetector(
        key: ValueKey('image${d.file_path}'),
        onTap: () =>
            dispatch(MovieDetailPageActionCreator.stillImageTapped(index)),
        child: Hero(
            tag: url + index.toString(),
            child: _buildImage(
              url,
              Adapt.px(320),
              Adapt.px(180),
              Adapt.px(15),
              margin: EdgeInsets.only(right: Adapt.px(30)),
            )),
      );
    }

    Widget _buildKeyWordCell(KeyWordData d) {
      return Chip(
        key: ValueKey('keyword${d.id}'),
        elevation: 3.0,
        backgroundColor: _theme.cardColor,
        label: Text(d.name),
      );
    }

    Widget _buildRecommendationCell(VideoListResult d) {
      double _width = Adapt.px(220);
      return GestureDetector(
        key: ValueKey('recommendation${d.id}'),
        onTap: () => dispatch(
            MovieDetailPageActionCreator.movieCellTapped(d.id, d.poster_path)),
        child: Padding(
          padding: EdgeInsets.only(right: Adapt.px(30)),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: <Widget>[
              _buildImage(ImageUrl.getUrl(d.poster_path, ImageSize.w500),
                  _width, Adapt.px(320), Adapt.px(20)),
              SizedBox(
                height: Adapt.px(15),
              ),
              Container(
                width: _width,
                child: Text(
                  d.title,
                  softWrap: true,
                  overflow: TextOverflow.ellipsis,
                  maxLines: 1,
                  style: TextStyle(
                      fontWeight: FontWeight.bold, fontSize: Adapt.px(24)),
                ),
              ),
              SizedBox(
                height: Adapt.px(8),
              ),
              Text(
                  '${DateTime.parse(d.release_date.isEmpty ? '2020-01-01' : d.release_date).year}',
                  style: TextStyle(fontSize: Adapt.px(24))),
              SizedBox(
                height: Adapt.px(8),
              ),
              Container(
                  width: _width,
                  child: RatingBarIndicator(
                    itemPadding: EdgeInsets.only(right: Adapt.px(5)),
                    itemSize: Adapt.px(25),
                    itemBuilder: (context, _) => Icon(
                      Icons.star,
                      color: Colors.amber,
                    ),
                    unratedColor: Colors.grey[300],
                    rating: d.vote_average / 2,
                  ))
            ],
          ),
        ),
      );
    }

    Widget _buildHeader() {
      Widget _bg = state.bgPic == null
          ? Container(
              key: ValueKey('bgEmpty'),
            )
          : Container(
              width: Adapt.screenW(),
              key: ValueKey(state.bgPic),
              decoration: BoxDecoration(
                image: DecorationImage(
                    fit: BoxFit.cover,
                    image: CachedNetworkImageProvider(
                        ImageUrl.getUrl(state.bgPic, ImageSize.w500))),
              ),
              child: ScrollViewBackGround(
                scrollController: state.scrollController,
                height: Adapt.px(750).floorToDouble(),
                maxOpacity: 0.8,
              ));
      Widget _headerTitle = state.detail?.title == null
          ? Shimmer.fromColors(
              baseColor: _theme.primaryColorDark,
              highlightColor: _theme.primaryColorLight,
              child: Column(
                mainAxisSize: MainAxisSize.max,
                crossAxisAlignment: CrossAxisAlignment.start,
                children: <Widget>[
                  Container(
                    width: Adapt.px(400),
                    height: Adapt.px(40),
                    color: _theme.primaryColorDark,
                  ),
                  SizedBox(
                    height: Adapt.px(10),
                  ),
                  Container(
                    width: Adapt.px(120),
                    height: Adapt.px(24),
                    color: _theme.primaryColorDark,
                  ),
                  SizedBox(
                    height: Adapt.px(10),
                  ),
                  Container(
                    width: Adapt.px(200),
                    height: Adapt.px(24),
                    color: _theme.primaryColorDark,
                  ),
                ],
              ),
            )
          : Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: <Widget>[
                Container(
                  width: Adapt.px(600),
                  child: Text(
                    state.detail?.title ?? '',
                    maxLines: 1,
                    overflow: TextOverflow.ellipsis,
                    style: TextStyle(
                        fontSize: Adapt.px(40), fontWeight: FontWeight.bold),
                  ),
                ),
                SizedBox(
                  height: Adapt.px(10),
                ),
                Text(DateFormat.yMMMd().format(DateTime.parse(
                    state.detail?.release_date ?? '1990-01-01'))),
                SizedBox(
                  height: Adapt.px(10),
                ),
                RichText(
                  text: TextSpan(
                      style: TextStyle(color: Colors.grey),
                      children: <TextSpan>[
                        TextSpan(
                            text: state.detail?.genres
                                    ?.map((f) {
                                      return f.name;
                                    })
                                    ?.toList()
                                    ?.take(3)
                                    ?.join(' / ') ??
                                ''),
                        TextSpan(text: ' · '),
                        TextSpan(
                            text: _covertDuration(state.detail?.runtime ?? 0))
                      ]),
                ),
                SizedBox(
                  height: Adapt.px(10),
                ),
                Row(
                  children: <Widget>[
                    RatingBarIndicator(
                      rating: (state.detail?.vote_average ?? 0.0) / 2,
                      itemPadding: EdgeInsets.only(right: Adapt.px(8)),
                      itemCount: 5,
                      itemBuilder: (context, _) => Icon(
                        Icons.star,
                        color: Colors.amber,
                      ),
                      unratedColor: Colors.grey,
                      itemSize: Adapt.px(25),
                    ),
                    SizedBox(
                      width: Adapt.px(8),
                    ),
                    Text(
                      '${state.detail?.vote_average ?? 0.0}',
                      style: TextStyle(fontWeight: FontWeight.bold),
                    ),
                    SizedBox(
                      width: Adapt.px(8),
                    ),
                    Text('(${state.detail?.vote_count ?? 0})'),
                  ],
                ),
              ],
            );
      return SliverAppBar(
        elevation: 10.0,
        backgroundColor: Colors.blueGrey,
        pinned: true,
        expandedHeight: Adapt.px(1100).floorToDouble(),
        actions: <Widget>[
          IconButton(
            onPressed: () => dispatch(MovieDetailPageActionCreator.openMenu()),
            icon: Icon(Icons.more_vert),
          )
        ],
        flexibleSpace: AnimatedSwitcher(
          duration: Duration(milliseconds: 600),
          child: _bg,
        ),
        bottom: PreferredSize(
          preferredSize: Size.fromHeight(Adapt.px(300)),
          child: Stack(
            alignment: Alignment.bottomRight,
            children: <Widget>[
              Container(
                  width: Adapt.screenW(),
                  height: Adapt.px(250),
                  padding: EdgeInsets.fromLTRB(
                      Adapt.px(40), Adapt.px(40), Adapt.px(40), 0),
                  decoration: BoxDecoration(
                      color: _theme.backgroundColor,
                      border: Border.all(color: _theme.backgroundColor),
                      borderRadius: BorderRadius.vertical(
                          top: Radius.circular(Adapt.px(50)))),
                  child: _headerTitle),
              Container(
                margin:
                    EdgeInsets.only(right: Adapt.px(60), bottom: Adapt.px(200)),
                width: Adapt.px(100),
                height: Adapt.px(100),
                child: FlatButton(
                  padding: EdgeInsets.zero,
                  color: state.hasStreamLink ? Colors.orange[600] : Colors.red,
                  shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(Adapt.px(50))),
                  highlightColor: Colors.red,
                  child: Icon(
                    Icons.play_arrow,
                    color: Colors.white,
                    size: Adapt.px(45),
                  ),
                  onPressed: () =>
                      dispatch(MovieDetailPageActionCreator.playTrailer()),
                ),
              ),
              Container(
                margin:
                    EdgeInsets.only(bottom: Adapt.px(30), right: Adapt.px(40)),
                width: Adapt.px(250),
                child: _getExternal(),
              )
            ],
          ),
        ),
      );
    }

    Widget _buildOverWatch() {
      Widget _overWatch = state.detail?.overview == null
          ? Shimmer.fromColors(
              baseColor: _theme.primaryColorDark,
              highlightColor: _theme.primaryColorLight,
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: <Widget>[
                  Container(
                    height: Adapt.px(24),
                    color: Colors.grey[200],
                  ),
                  SizedBox(
                    height: Adapt.px(8),
                  ),
                  Container(
                    height: Adapt.px(24),
                    color: Colors.grey[200],
                  ),
                  SizedBox(
                    height: Adapt.px(8),
                  ),
                  Container(
                    height: Adapt.px(24),
                    color: Colors.grey[200],
                  ),
                  SizedBox(
                    height: Adapt.px(8),
                  ),
                  Container(
                    width: Adapt.px(300),
                    height: Adapt.px(24),
                    color: Colors.grey[200],
                  )
                ],
              ),
            )
          : Text(state.detail?.overview ?? '');
      return SliverToBoxAdapter(
        child: Container(
          padding: EdgeInsets.symmetric(horizontal: Adapt.px(40)),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: <Widget>[
              SizedBox(
                height: Adapt.px(30),
              ),
              Text(
                I18n.of(viewService.context).overView,
                style: TextStyle(
                    fontWeight: FontWeight.bold, fontSize: Adapt.px(35)),
              ),
              SizedBox(
                height: Adapt.px(20),
              ),
              _overWatch,
            ],
          ),
        ),
      );
    }

    Widget _buildCast() {
      var _model = state.detail?.credits?.cast ?? [];
      return SliverToBoxAdapter(
        child: Container(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: <Widget>[
              SizedBox(
                height: Adapt.px(50),
              ),
              Padding(
                padding: EdgeInsets.symmetric(horizontal: Adapt.px(40)),
                child: Text(
                  I18n.of(viewService.context).topBilledCast,
                  style: TextStyle(
                      fontWeight: FontWeight.bold, fontSize: Adapt.px(35)),
                ),
              ),
              SizedBox(
                height: Adapt.px(30),
              ),
              Container(
                height: Adapt.px(300),
                child: ListView(
                    scrollDirection: Axis.horizontal,
                    children: _model.length == 0
                        ? <Widget>[
                            SizedBox(
                              width: Adapt.px(40),
                            ),
                            _buildCastShimmerCell(),
                            SizedBox(
                              width: Adapt.px(30),
                            ),
                            _buildCastShimmerCell(),
                            SizedBox(
                              width: Adapt.px(30),
                            ),
                            _buildCastShimmerCell(),
                            SizedBox(
                              width: Adapt.px(30),
                            ),
                            _buildCastShimmerCell()
                          ]
                        : (state.detail.credits.cast
                            .map(_buildCastCell)
                            .toList()
                              ..insert(
                                  0,
                                  SizedBox(
                                    width: Adapt.px(40),
                                  )))),
              )
            ],
          ),
        ),
      );
    }

    Widget _buildStill() {
      return SliverToBoxAdapter(
        child: Container(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: <Widget>[
              SizedBox(
                height: Adapt.px(30),
              ),
              Padding(
                padding: EdgeInsets.symmetric(horizontal: Adapt.px(40)),
                child: Text(
                  'Stills',
                  style: TextStyle(
                      fontWeight: FontWeight.bold, fontSize: Adapt.px(35)),
                ),
              ),
              SizedBox(
                height: Adapt.px(30),
              ),
              Container(
                height: Adapt.px(180),
                child: ListView(
                    scrollDirection: Axis.horizontal,
                    children: state.imagesmodel.backdrops.length == 0
                        ? <Widget>[
                            SizedBox(
                              width: Adapt.px(40),
                            ),
                            ShimmerCell(
                                Adapt.px(320), Adapt.px(180), Adapt.px(20),
                                baseColor: _theme.primaryColorDark,
                                highlightColor: _theme.primaryColorLight),
                            SizedBox(
                              width: Adapt.px(30),
                            ),
                            ShimmerCell(
                                Adapt.px(320), Adapt.px(180), Adapt.px(20),
                                baseColor: _theme.primaryColorDark,
                                highlightColor: _theme.primaryColorLight),
                            SizedBox(
                              width: Adapt.px(30),
                            ),
                            ShimmerCell(
                                Adapt.px(320), Adapt.px(180), Adapt.px(20),
                                baseColor: _theme.primaryColorDark,
                                highlightColor: _theme.primaryColorLight)
                          ]
                        : (state.imagesmodel.backdrops
                            .map(_buildImageCell)
                            .toList()
                              ..insert(
                                  0,
                                  SizedBox(
                                    width: Adapt.px(40),
                                  )))),
              ),
              SizedBox(
                height: Adapt.px(50),
              ),
            ],
          ),
        ),
      );
    }

    Widget _buildKeyWord() {
      var _model = state.detail?.keywords?.keywords ?? [];
      return SliverToBoxAdapter(
        child: Container(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: <Widget>[
              Padding(
                padding: EdgeInsets.symmetric(horizontal: Adapt.px(40)),
                child: Text(
                  'KeyWords',
                  style: TextStyle(
                      fontWeight: FontWeight.bold, fontSize: Adapt.px(35)),
                ),
              ),
              SizedBox(
                height: Adapt.px(10),
              ),
              Container(
                padding: EdgeInsets.fromLTRB(
                    Adapt.px(40), 0, Adapt.px(40), Adapt.px(30)),
                child: Wrap(
                  spacing: Adapt.px(15),
                  direction: Axis.horizontal,
                  children: _model.length == 0
                      ? <Widget>[
                          ShimmerCell(Adapt.px(120), Adapt.px(60), Adapt.px(30),
                              baseColor: _theme.primaryColorDark,
                              highlightColor: _theme.primaryColorLight,
                              margin: EdgeInsets.only(top: Adapt.px(20))),
                          ShimmerCell(Adapt.px(180), Adapt.px(60), Adapt.px(30),
                              baseColor: _theme.primaryColorDark,
                              highlightColor: _theme.primaryColorLight,
                              margin: EdgeInsets.only(top: Adapt.px(20))),
                          ShimmerCell(Adapt.px(200), Adapt.px(60), Adapt.px(30),
                              baseColor: _theme.primaryColorDark,
                              highlightColor: _theme.primaryColorLight,
                              margin: EdgeInsets.only(top: Adapt.px(20))),
                        ]
                      : state.detail.keywords.keywords
                          .map(_buildKeyWordCell)
                          .toList(),
                ),
              )
            ],
          ),
        ),
      );
    }

    Widget _buildRecommendations() {
      var _model = state.detail?.recommendations?.results ?? [];
      return SliverToBoxAdapter(
          child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: <Widget>[
            Padding(
              padding: EdgeInsets.symmetric(horizontal: Adapt.px(40)),
              child: Text(
                I18n.of(viewService.context).recommendations,
                style: TextStyle(
                    fontWeight: FontWeight.bold, fontSize: Adapt.px(35)),
              ),
            ),
            SizedBox(
              height: Adapt.px(30),
            ),
            Container(
              height: Adapt.px(450),
              child: ListView(
                  scrollDirection: Axis.horizontal,
                  children: _model.length == 0
                      ? <Widget>[
                          SizedBox(
                            width: Adapt.px(40),
                          ),
                          _buildRecommendationShimmerCell(),
                          SizedBox(
                            width: Adapt.px(30),
                          ),
                          _buildRecommendationShimmerCell(),
                          SizedBox(
                            width: Adapt.px(30),
                          ),
                          _buildRecommendationShimmerCell()
                        ]
                      : (state.detail.recommendations.results
                          .map(_buildRecommendationCell)
                          .toList()
                            ..insert(
                                0,
                                SizedBox(
                                  width: Adapt.px(40),
                                )))),
            ),
            SizedBox(
              height: Adapt.px(30),
            ),
          ]));
    }

    return Scaffold(
      key: state.scaffoldkey,
      backgroundColor: _theme.backgroundColor,
      body: CustomScrollView(
        controller: state.scrollController,
        physics: ClampingScrollPhysics(),
        slivers: <Widget>[
          _buildHeader(),
          _buildOverWatch(),
          _buildCast(),
          _buildStill(),
          _buildKeyWord(),
          _buildRecommendations(),
        ],
      ),
    );
  });
}
